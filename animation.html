<!DOCTYPE html>
<html>
<head>
<title>Playroom</title>
<script src="linkedlist.js"></script>
<script src="animation.js"></script>
<style>
canvas {
    outline: solid 1px black;
}
#canvas-code {
    width: 700px;
    height: 3000px;
}
</style>
</head>
<body onload="initialize()">
<canvas id="canvas" width="720" height="3000"></canvas>
<textarea id="canvas-code">
let k = 5;
let offsetX = k * 15;  let offsetY = 15;
let marginX = 20;      let marginY = 20;
let scale = 3;
let radius = 5;
let runStats = false;
let circleSettings= {visible: true, alpha: 0.2, red: 0, green: 0, blue: 0}
let lineSettings = {visible: true, alpha: 0.2, red: 0, green: 0, blue: 0};

if (k > 13) return;

let circles = {};
for (let i = 0; i < 2**k; i++) {
    for (let j = 0; j < k + 1; ++j) {
        circles[[i, j]] = Circle(offsetX * j, offsetY * i, radius, circleSettings);
    }
}

let arrows = {};
for (let i = 0; i < 2**k; i++) {
    for (let j = 0; j < k; ++j) {
       let from = circles[[i, j]];
       let to0 = circles[[i, j+1]];
       let to1 = circles[[ij(i, j), j+1]];
       arrows[[i, j, 0]] = Line(From(from), To(to0), lineSettings);
       arrows[[i, j, 1]] = Line(From(from), To(to1), lineSettings);
    }
}

ctx.transform(scale, 0, 0, scale, 0, 0);
ctx.translate(marginX , marginY)

let t = 13
//colorPath(t, k, 1, 0, 0);
colorPathRev(0, 0, 1, 0, 0.0);
colorPathRev(1, 0, 1, 0, 0.0);

colorPathRev(2, 0, 1, 0, 0.0);
colorPathRev(3, 0, 1, 0, 0.0);

colorNode(2,1, 0,0,0,0.01)
colorNode(3,1, 0,0,0,0.01)


for (let t = k-1; t > 0; --t) {
    for (let i = 2; i < 2**t; i += 2) {
       // colorPathRev(i, t-1, 0, 0, 0);
    }
}

function ij(i, j) { 
    return i ^ (2**j)
}

colorPathBetween(0, 31, 0, 0, 1, 1);
colorPathBetween(1, 1, 0, 0.8, 0, 1);
//colorPathBetween(22, t, 0, 0, 1, 1);

function colorPathBetween(i1, i2, r, g, b, a) {
    let bs1 = i1.toString(2).padStart(k+1,'0');
    let bs2 = i2.toString(2).padStart(k+1,'0');

    let i = i1;
    for (let j = 0; j < k; ++j) {
        let b1 = bs1.charAt(k-j);
        let b2 = bs2.charAt(k-j);
        
        colorMixNode(i, j, r, g, b, a)
        if (b1 != b2) {// Cross
            colorMixArrow(i, j, 1, r, g, b, a)
            i = i ^ (2**j);
        } else {
            colorMixArrow(i, j, 0, r, g, b, a)
        }        
    }
    colorMixNode(i, k, r, g, b, a)
}

function colorPath(i, j, red, green, blue) {
    colorMixNode(i, j, red, green, blue, 1)
    if (j == 0) return;
    colorPath(i, j-1, red, green, blue);
    let crossIdx = ij(i, j-1);
    colorPath(crossIdx, j-1, red, green, blue);

    colorMixArrow(i, j-1, 0, red, green, blue, 1)
    colorMixArrow(crossIdx, j-1, 1, red, green, blue, 1)
}

function colorPathRev(i, j, red, green, blue) {
    colorMixNode(i, j, red, green, blue, 1)
    if (j == k) return;
    colorPathRev(i, j+1, red, green, blue);
    let crossIdx = ij(i, j);
    colorPathRev(crossIdx, j+1, red, green, blue);

    colorMixArrow(i, j, 0, red, green, blue, 1)
    colorMixArrow(i, j, 1, red, green, blue, 1)
}
function colorMixNode(i, j, red, green, blue, alpha) {
    circles[[i, j]].red += red;
    circles[[i, j]].green += green;
    circles[[i, j]].blue += blue;
    circles[[i,j]].alpha += alpha;
}

function colorNode(i, j, red, green, blue, alpha) {
    circles[[i, j]].red = red;
    circles[[i, j]].green = green;
    circles[[i, j]].blue = blue;
    circles[[i,j]].alpha = alpha;
}


function colorMixArrow(i, j, t, red, green, blue, alpha) {
    let idx = [i,j,t];
    arrows[idx].alpha = alpha;
    arrows[idx].red+= red;
    arrows[idx].green+= green;
    arrows[idx].blue+= blue;
}

if (!runStats) return;

let tests = [];
tests.push({name: "green", prop: function(c) { return c.green > 0.5 }});
tests.push({name: "red", prop: function(c) { return c.red > 0.5 }});
tests.push({name: "blue", prop: function(c) { return c.blue > 0.5 }});
tests.push({name: "redGreen", prop: function(c) { return c.red > 0.5 && c.green > 0.5 }});
tests.push({name: "redBlue", prop: function(c) { return c.red > 0.5 && c.blue > 0.5 }});
tests.push({name: "blueGreen", prop: function(c) { return c.blue > 0.5 && c.green > 0.5}});
tests.push({name: "all", prop: function(c) { return c.red > 0.5 && c.blue > 0.5 && c.green}});

let stats = {};
for (let test of tests) {
    stats[test.name] = 0
}

for (let i = 0; i < 2**k; i++) {
    for (let j = 0; j < k + 1; ++j) {
        let c = circles[[i,j]];
        for (let test of tests) {
            if (test.prop(c)) {
                stats[test.name]++;
            }
        }

    }
}
console.log(stats);
</textarea>
<br>
<input id="time-range" type="range" min="0" max="100" value="0">
<input id="duration-text" type="text" disabled value="0ms">
<button id="play-button">Play</button>
<div id="animation-list"></div>
</body>
</html>
